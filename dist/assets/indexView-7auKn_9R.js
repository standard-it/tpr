import{d as A,e as q,A as h,c as C,r as j,B as z,o as y,_ as I,l as G,v as H,C as Z,x as L,j as J,F,b as x,u as o,p as w,a as f,w as S,h as K,y as O,i as T,f as Q}from"./index-DEZaLq76.js";import{C as ee}from"./ComponentButton-C3meVf2-.js";import{C as E}from"./ComponentDropdownList-CakEUtGU.js";import{C as te}from"./ComponentHeading-BwTxAJ3r.js";import{C as B}from"./ComponentInput-CTghgZJM.js";import{u as R,a as oe,b as ne}from"./index-CSKS9Ij0.js";import{u as se}from"./index-HHQrPdE9.js";import{u as le}from"./index-EbIPtxbL.js";import{u as ie}from"./index-BegdO8CZ.js";import"./index-CznklluM.js";import"./index-DTEV5yGJ.js";import"./axios-CCb-kr4I.js";const re=A({__name:"ComponentDialog",setup(v,{expose:d}){const n=q(),r=a=>{if(n.value){const{clientX:p,clientY:_}=a;n.value.style.inset=`${_}px auto auto ${p}px`,n.value.show()}},t=()=>{n.value&&n.value.showModal()},u=()=>{n.value&&n.value.close()};return d({show:r,showModal:t,close:u}),(a,p)=>{const _=z("outside");return h((y(),C("dialog",{ref_key:"dialog",ref:n},[j(a.$slots,"default",{},void 0,!0)])),[[_,u]])}}}),W=I(re,[["__scopeId","data-v-232ebf0a"]]);function X(v){return{getCoordinates:n=>{if(!v.value)return null;const r=v.value.createSVGPoint();r.x=n.clientX,r.y=n.clientY;const t=v.value.getScreenCTM();if(!t)return{x:0,y:0};const u=r.matrixTransform(t.inverse());return{x:u.x,y:u.y}}}}function ue(v){const{getCoordinates:d}=X(v),n=q(null),r=a=>{n.value=a},t=a=>{if(!n.value)return;const p=d(a);if(p){const{x:_,y:M}=p;n.value.point_positions={...n.value.point_positions,x:_,y:M}}},u=()=>{n.value=null};return G(()=>{document.addEventListener("mousemove",t),document.addEventListener("mouseup",u)}),H(()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",u)}),{startDragging:r}}const ae=["d","transform"],me=["cx","cy","r","onMousedown","onWheel","onMouseenter"],de=A({__name:"ComponentPoint",props:{parent:{}},setup(v){const d=R(),n=v,{parent:r}=Z(n),{wheel:t,path:u,transform:a}=oe(),{startDragging:p}=ue(r),_=V=>{d.element={...V}},M=L(()=>{var V;return(V=d.elements)==null?void 0:V.filter($=>$.schemes_id===d.element.schemes_id&&$.equipment_categories_id===d.element.equipment_categories_id)});return(V,$)=>(y(!0),C(F,null,J(M.value,(c,U)=>{var b,D,P;return y(),C("g",{key:U},[x("path",{d:o(u)(c),transform:o(a)(c)},null,8,ae),x("circle",{cx:(b=c.point_positions)==null?void 0:b.x,cy:(D=c.point_positions)==null?void 0:D.y,r:(P=c.point_positions)==null?void 0:P.r,onMousedown:w(k=>o(p)(c),["left","stop"]),onWheel:w(k=>o(t)(c,k),["stop"]),onMouseenter:w(k=>_(c),["stop"])},null,40,me)])}),128))}}),pe=I(de,[["__scopeId","data-v-c4367d8c"]]),ce=["href"],fe=A({__name:"indexView",setup(v){const d="http://192.168.20.8",n=q(),r=q(),t=R(),u=ie(),a=le(),p=q(null),_=m=>{const{getCoordinates:e}=X(p),i=e(m);if(i){const{x:s,y:l}=i;t.element&&(t.element={...t.element,point_positions:{...t.element.point_positions,x:s,y:l}})}},M=L(()=>{var m;return(m=a.elements)==null?void 0:m.filter(e=>{var i;return e.equipment_categories_id===t.element.equipment_categories_id&&!((i=t.elements)!=null&&i.some(s=>s.equipments_id===e.id))})}),{state:V,startDrag:$,drag:c,endDrag:U,zoom:b}=ne(),D=L(()=>{const{x:m,y:e,scale:i}=V.value;return`translate(${m}px, ${e}px) scale(${i})`}),P=L(()=>{const m=u.elements.find(e=>e.id===t.element.schemes_id);return m?`${d}/in/${m.file}`:""}),k=()=>{n.value.close();const{schemes_id:m,equipment_categories_id:e,point_positions:i}=t.element;t.element={equipment_categories_id:e,equipments_id:0,point_positions:{a:90,d:0,l:100,r:10,x:i==null?void 0:i.x,y:i==null?void 0:i.y},schemes_id:m},r.value.showModal()},N=se(),Y=()=>{n.value.close(),t.remove(t.element.id)};return a.fetchAll(),t.fetchAll(),u.fetchAll(),N.fetchAll(),(m,e)=>{const i=z("outside");return y(),C("main",null,[f(te,null,{default:S(()=>{var s,l;return[e[16]||(e[16]=x("h1",null,"Управление",-1)),e[17]||(e[17]=x("p",null,"План помещения и категорию оборудования. Расставьте на плане оборудование.",-1)),f(E,{label:"План помещения",options:(s=o(u).elements)==null?void 0:s.map(g=>({value:g.id,label:g.name})),modelValue:o(t).element.schemes_id,"onUpdate:modelValue":e[0]||(e[0]=g=>o(t).element.schemes_id=g)},null,8,["options","modelValue"]),f(E,{label:"Категория оборудования",options:(l=o(N).elements)==null?void 0:l.map(g=>({value:g.id,label:g.name})),modelValue:o(t).element.equipment_categories_id,"onUpdate:modelValue":e[1]||(e[1]=g=>o(t).element.equipment_categories_id=g)},null,8,["options","modelValue"])]}),_:1}),h((y(),K(W,{ref_key:"contextmenu",ref:n},{default:S(()=>[x("ul",null,[x("li",{onClick:e[2]||(e[2]=s=>k())},"Создать элемент"),x("li",{onClick:e[3]||(e[3]=s=>(r.value.showModal(),n.value.close()))},"Редактировать"),x("li",{onClick:e[4]||(e[4]=s=>Y())},"Удалить")])]),_:1})),[[i,()=>n.value.close()]]),f(W,{ref_key:"modal",ref:r},{default:S(()=>{var s;return[h((y(),C("form",null,[f(E,{label:"Список оборудования",options:(s=M.value)==null?void 0:s.map(l=>({value:l.id,label:l.name})),modelValue:o(t).element.equipments_id,"onUpdate:modelValue":e[5]||(e[5]=l=>o(t).element.equipments_id=l)},null,8,["options","modelValue"]),o(t).element.point_positions?(y(),C(F,{key:0},[f(B,{label:"Направление",type:"text",modelValue:o(t).element.point_positions.d,"onUpdate:modelValue":e[6]||(e[6]=l=>o(t).element.point_positions.d=l),modelModifiers:{number:!0}},null,8,["modelValue"]),f(B,{label:"Дистанция / м",type:"text",modelValue:o(t).element.point_positions.l,"onUpdate:modelValue":e[7]||(e[7]=l=>o(t).element.point_positions.l=l),modelModifiers:{number:!0}},null,8,["modelValue"]),f(B,{label:"Угол обзора",type:"text",modelValue:o(t).element.point_positions.a,"onUpdate:modelValue":e[8]||(e[8]=l=>o(t).element.point_positions.a=l),modelModifiers:{number:!0}},null,8,["modelValue"]),f(B,{label:"Размер точки",type:"text",modelValue:o(t).element.point_positions.r,"onUpdate:modelValue":e[9]||(e[9]=l=>o(t).element.point_positions.r=l),modelModifiers:{number:!0}},null,8,["modelValue"])],64)):T("",!0),f(ee,{onClick:e[10]||(e[10]=l=>(o(t).element.id?o(t).update(o(t).element.id):o(t).save(),r.value.close()))},{default:S(()=>e[18]||(e[18]=[Q("Сохранить")])),_:1})])),[[i,()=>r.value.close()]])]}),_:1},512),x("section",null,[(y(),C("svg",{ref_key:"svg",ref:p,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 720 720",width:"920",style:O({transform:D.value}),onContextmenu:[e[11]||(e[11]=w(s=>n.value.show(s),["prevent"])),w(_,["right"])],onMousedown:e[12]||(e[12]=w((...s)=>o($)&&o($)(...s),["prevent"])),onMousemove:e[13]||(e[13]=(...s)=>o(c)&&o(c)(...s)),onMouseup:e[14]||(e[14]=(...s)=>o(U)&&o(U)(...s)),onWheel:e[15]||(e[15]=w((...s)=>o(b)&&o(b)(...s),["prevent"]))},[o(t).element.schemes_id?(y(),C("image",{key:0,href:P.value},null,8,ce)):T("",!0),f(pe,{parent:p.value},null,8,["parent"])],36))])])}}}),qe=I(fe,[["__scopeId","data-v-c505ede3"]]);export{qe as default};
