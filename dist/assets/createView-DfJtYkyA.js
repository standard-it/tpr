import{d as I,x as V,e as A,E as T,v as q,c as m,a as s,w as u,b as n,F as y,j as B,u as p,h as S,i as v,o as i,f as d,p as j,A as L,H as P,t as b,_ as z}from"./index-DEZaLq76.js";import{C as k}from"./ComponentButton-C3meVf2-.js";import{C as w}from"./ComponentCard-D_QuY9Lo.js";import{C as G}from"./ComponentDropdownList-CakEUtGU.js";import{C as J}from"./ComponentHeading-BwTxAJ3r.js";import{C as E}from"./ComponentInput-CTghgZJM.js";import{C as K}from"./ComponentFile-C6H_0CMB.js";import{s as Q}from"./index-CznklluM.js";import{P as W,m as X}from"./index-Bhxkf1XE.js";import{u as Y}from"./index-CNpF5jdz.js";import{u as Z}from"./index-BzCdFny3.js";import{u as _}from"./index-C9quTG-i.js";import"./index-DTEV5yGJ.js";import"./axios-CCb-kr4I.js";const ee={style:{width:"fit-content"}},te={key:0},ne=["value"],le={key:2},oe=I({__name:"createView",setup(ae){const o=_(),g=Y(),M=(t,e,l)=>({id:t,name:e,value:({payload:r})=>{const a=!["exten =>","include =>"].includes(l.trim()),c=r?a?`(${r})`:r:"";return`${l}${c}`}}),U=V(()=>g.elements.map(t=>M(t.id,t.name,t.ext))),N=()=>{o.element.action_param.push({params:{payload:""}})},h=t=>{o.element.action_param.splice(t,1)};o.element.extension=V(()=>o.element.action_param.map(t=>{const e=U.value.find(l=>l.id===t.id);return e?typeof e.value=="function"?e.value(t.params):e.value:""})),g.fetchAll();const F=()=>{const t=`[${o.element.name}]
${o.element.extension.join(`
`)}`,e=new Blob([t],{type:"text/plain"}),l=URL.createObjectURL(e),r=document.createElement("a");r.href=l,r.download=`${o.element.name}.txt`,r.click(),URL.revokeObjectURL(l)},$=Z(),C=A(!1),f=A([]),R=()=>{const t=o.element.action_param.find(e=>e.id===5);if(t){const e=t.params.payload||"",l=e.match(/^[^=]+=|^/),r=l?l[0]:"",a=e.replace(r,"").split(/[,&]/).filter(Boolean),c=new Set(f.value);f.value.forEach(x=>c.add(x)),a.forEach(x=>{f.value.includes(x)||c.delete(x)}),t.params.payload=r+Array.from(c).join(",")}};T(()=>{const t=o.element.action_param.find(e=>e.id===5);return t?t.params.payload:""},t=>{if(t){const e=t.match(/^[^=]+=|^/),l=e?e[0]:"",r=t.replace(l,"").split(/[,&]/).filter(Boolean);f.value=r}else f.value=[]}),$.fetchAll();const D=V(()=>$.elements),H=new W({fieldName:"name",rule:t=>X(t,4),errorMessage:"Обязательно укажите наименование"}),O=()=>{const t=H.validate(o.element);if(Object.keys(t).length!==0){Q(t);return}o.save()};return q(()=>{o.element={name:"",action_param:[],extension:[]}}),(t,e)=>(i(),m("main",null,[s(J,null,{nav:u(()=>[s(k,{to:{name:"dialplan"}},{default:u(()=>e[6]||(e[6]=[d("Назад")])),_:1}),s(k,{onClick:e[0]||(e[0]=l=>O())},{default:u(()=>e[7]||(e[7]=[d("Сохранить")])),_:1}),p(o).element.extension.length?(i(),S(k,{key:0,onClick:F},{default:u(()=>e[8]||(e[8]=[d("Сохранить в файл")])),_:1})):v("",!0)]),default:u(()=>[e[9]||(e[9]=n("h1",null,"Новая запись",-1)),e[10]||(e[10]=n("p",null,"Укажите наименование диалплана, постарайтесь выбрать короткое и лаконичное наименование",-1))]),_:1}),n("section",null,[s(w,{tag:"article"},{default:u(()=>[n("form",{onSubmit:e[2]||(e[2]=j(()=>{},["prevent"]))},[s(E,{type:"text",label:"Наименование",required:"name",modelValue:p(o).element.name,"onUpdate:modelValue":e[1]||(e[1]=l=>p(o).element.name=l)},null,8,["modelValue"])],32)]),_:1}),(i(!0),m(y,null,B(p(o).element.action_param,(l,r)=>(i(),m("div",{key:r},[s(w,{tag:"article"},{default:u(()=>[n("form",{onSubmit:e[5]||(e[5]=j(()=>{},["prevent"]))},[s(G,{label:"Действие",options:U.value.map(a=>({value:a.id,label:a.name})),modelValue:l.id,"onUpdate:modelValue":a=>l.id=a},null,8,["options","modelValue","onUpdate:modelValue"]),l.id===4?(i(),m(y,{key:0},[e[11]||(e[11]=n("p",null," Загружаемые медиа файлы должны соответствовать определённым требованиям, чтобы гарантировать совместимость: ",-1)),e[12]||(e[12]=n("ul",null,[n("li",null,"Формат: PCM"),n("li",null,"Частота дискретизации: 8000 Гц (8 kHz)"),n("li",null,"Разрядность: 16 бит"),n("li",null,"Каналы: моно")],-1)),s(K)],64)):v("",!0),l.id===5?(i(),m(y,{key:1},[n("label",ee,[e[13]||(e[13]=d(" Добавить пользователей ")),L(n("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>C.value=a)},null,512),[[P,C.value]])]),e[15]||(e[15]=n("br",null,null,-1)),C.value?(i(),m("table",te,[e[14]||(e[14]=n("thead",null,[n("tr",null,[n("th",{style:{width:"20px"}}),n("th",null,"ФИО"),n("th",null,"Номер телефона"),n("th",null,"Должность")])],-1)),n("tbody",null,[(i(!0),m(y,null,B(D.value,a=>(i(),m("tr",{key:a.id},[n("td",null,[L(n("input",{type:"checkbox",value:a.phone,"onUpdate:modelValue":e[4]||(e[4]=c=>f.value=c),onChange:R},null,40,ne),[[P,f.value]])]),n("td",null,b(a.fullname),1),n("td",null,b(a.phone),1),n("td",null,b(a.position),1)]))),128))])])):v("",!0)],64)):v("",!0),s(E,{type:"text",label:"Параметры",modelValue:l.params.payload,"onUpdate:modelValue":a=>l.params.payload=a},null,8,["modelValue","onUpdate:modelValue"]),p(o).element.extension[r]!==""?(i(),m("pre",le,b(p(o).element.extension[r]),1)):v("",!0)],32),s(k,{onClick:a=>h(r)},{default:u(()=>e[16]||(e[16]=[d("Убрать")])),_:2},1032,["onClick"])]),_:2},1024)]))),128)),s(k,{onClick:N},{default:u(()=>e[17]||(e[17]=[d("Добавить действие")])),_:1}),p(o).element.extension.length?(i(),S(w,{key:0,tag:"article",style:{"white-space":"break-spaces"}},{default:u(()=>[d(" ["+b(p(o).element.name)+"] ",1),e[18]||(e[18]=n("br",null,null,-1)),d(" "+b(p(o).element.extension.join(`
 `)),1)]),_:1})):v("",!0)])]))}}),Ce=z(oe,[["__scopeId","data-v-bfebd211"]]);export{Ce as default};
