import{d as z,x as A,E as $,e as B,v as _,c as f,a as s,w as i,b as n,F as C,j as S,u,h,i as y,q as G,o as m,f as p,t as v,p as j,A as E,H as L,_ as J}from"./index-DEZaLq76.js";import{C as x}from"./ComponentButton-C3meVf2-.js";import{C as V}from"./ComponentCard-D_QuY9Lo.js";import{C as K}from"./ComponentDropdownList-CakEUtGU.js";import{C as Q}from"./ComponentHeading-BwTxAJ3r.js";import{C as M}from"./ComponentInput-CTghgZJM.js";import{C as W}from"./ComponentFile-C6H_0CMB.js";import{s as X}from"./index-CznklluM.js";import{P as Y,m as Z}from"./index-Bhxkf1XE.js";import{u as ee}from"./index-CNpF5jdz.js";import{u as te}from"./index-BzCdFny3.js";import{u as ne}from"./index-C9quTG-i.js";import"./index-DTEV5yGJ.js";import"./axios-CCb-kr4I.js";const le={style:{width:"fit-content"}},oe={key:0},ae=["value"],re={key:2},se=z({__name:"updateView",setup(ie){const l=ne(),w=ee(),N=G(),R=(o,e,t)=>({id:o,name:e,value:({payload:r})=>{const a=!["exten => ","include => "].includes(t),d=r?a?`(${r})`:r:"";return`${t}${d}`}}),P=A(()=>w.elements.map(o=>R(o.id,o.name,o.ext))),F=()=>{l.element.action_param.push({params:{payload:""}})},O=o=>{l.element.action_param.splice(o,1)},g=()=>{l.element.extension=l.element.action_param.map(o=>{const e=P.value.find(t=>t.id===o.id);return e?typeof e.value=="function"?e.value(o.params):e.value:""})};$(()=>l.element.action_param,g,{deep:!0}),w.fetchAll(),l.fetchOne(+N.params.id).then(()=>{g();const o=l.element.action_param.find(e=>e.id===5);if(o){const e=o.params.payload||"",t=e.match(/^[^=]+=|^/),r=t?t[0]:"",a=e.replace(r,"").split(/[,&]/).filter(Boolean);c.value=a}$(()=>l.element.action_param.map(e=>e.params.payload),()=>{const e=l.element.action_param.find(t=>t.id===5);if(e){const t=e.params.payload||"",r=t.match(/^[^=]+=|^/),a=r?r[0]:"",d=t.replace(a,"").split(/[,&]/).filter(Boolean);c.value=d}},{deep:!0})});const D=()=>{const o=`[${l.element.name}]
${l.element.extension.join(`
`)}`,e=new Blob([o],{type:"text/plain"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`${l.element.name}.txt`,r.click(),URL.revokeObjectURL(t)},U=te(),b=B(!1),c=B([]),H=()=>{const o=l.element.action_param.find(e=>e.id===5);if(o){const e=o.params.payload||"",t=e.match(/^[^=]+=|^/),r=t?t[0]:"",a=e.replace(r,"").split(",").filter(Boolean),d=new Set(c.value);c.value.forEach(k=>d.add(k)),a.forEach(k=>{c.value.includes(k)||d.delete(k)}),o.params.payload=r+Array.from(d).join(",")}};U.fetchAll();const q=A(()=>U.elements),I=new Y({fieldName:"name",rule:o=>Z(o,4),errorMessage:"Обязательно укажите наименование"}),T=()=>{const o=I.validate(l.element);if(Object.keys(o).length!==0){X(o);return}l.update()};return _(()=>{l.element={name:"",action_param:[],extension:[]}}),(o,e)=>(m(),f("main",null,[s(Q,null,{nav:i(()=>[s(x,{to:{name:"dialplan"}},{default:i(()=>e[6]||(e[6]=[p("Назад")])),_:1}),s(x,{onClick:e[0]||(e[0]=t=>T())},{default:i(()=>e[7]||(e[7]=[p("Сохранить")])),_:1}),u(l).element.extension.length?(m(),h(x,{key:0,onClick:D},{default:i(()=>e[8]||(e[8]=[p("Сохранить в файл")])),_:1})):y("",!0),s(x,{onClick:u(l).remove},{default:i(()=>e[9]||(e[9]=[p("Удалить")])),_:1},8,["onClick"])]),default:i(()=>[n("h1",null,[e[10]||(e[10]=p("Редактирование ")),n("span",null,v(u(l).element.name),1)]),e[11]||(e[11]=n("p",null,"Укажите наименование диалплана, постарайтесь выбрать короткое и лаконичное наименование",-1))]),_:1}),n("section",null,[s(V,{tag:"article"},{default:i(()=>[n("form",{onSubmit:e[2]||(e[2]=j(()=>{},["prevent"]))},[s(M,{type:"text",label:"Наименование",required:"name",modelValue:u(l).element.name,"onUpdate:modelValue":e[1]||(e[1]=t=>u(l).element.name=t)},null,8,["modelValue"])],32)]),_:1}),(m(!0),f(C,null,S(u(l).element.action_param,(t,r)=>(m(),f("div",{key:r},[s(V,{tag:"article"},{default:i(()=>[n("form",{onSubmit:e[5]||(e[5]=j(()=>{},["prevent"]))},[s(K,{label:"Действие",options:P.value.map(a=>({value:a.id,label:a.name})),modelValue:t.id,"onUpdate:modelValue":a=>t.id=a},null,8,["options","modelValue","onUpdate:modelValue"]),t.id===4?(m(),f(C,{key:0},[e[12]||(e[12]=n("p",null," Загружаемые медиа файлы должны соответствовать определённым требованиям, чтобы гарантировать совместимость: ",-1)),e[13]||(e[13]=n("ul",null,[n("li",null,"Формат: PCM"),n("li",null,"Частота дискретизации: 8000 Гц (8 kHz)"),n("li",null,"Разрядность: 16 бит"),n("li",null,"Каналы: моно")],-1)),s(W)],64)):y("",!0),t.id===5?(m(),f(C,{key:1},[n("label",le,[e[14]||(e[14]=p(" Добавить пользователей ")),E(n("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a)},null,512),[[L,b.value]])]),e[16]||(e[16]=n("br",null,null,-1)),b.value?(m(),f("table",oe,[e[15]||(e[15]=n("thead",null,[n("tr",null,[n("th",{style:{width:"20px"}}),n("th",null,"ФИО"),n("th",null,"Номер телефона"),n("th",null,"Должность")])],-1)),n("tbody",null,[(m(!0),f(C,null,S(q.value,a=>(m(),f("tr",{key:a.id},[n("td",null,[E(n("input",{type:"checkbox",value:a.phone,"onUpdate:modelValue":e[4]||(e[4]=d=>c.value=d),onChange:H},null,40,ae),[[L,c.value]])]),n("td",null,v(a.fullname),1),n("td",null,v(a.phone),1),n("td",null,v(a.position),1)]))),128))])])):y("",!0)],64)):y("",!0),s(M,{type:"text",label:"Параметры",modelValue:t.params.payload,"onUpdate:modelValue":a=>t.params.payload=a},null,8,["modelValue","onUpdate:modelValue"]),u(l).element.extension[r]!==""?(m(),f("pre",re,v(u(l).element.extension[r]),1)):y("",!0)],32),s(x,{onClick:a=>O(r)},{default:i(()=>e[17]||(e[17]=[p("Убрать")])),_:2},1032,["onClick"])]),_:2},1024)]))),128)),s(x,{onClick:F},{default:i(()=>e[18]||(e[18]=[p("Добавить действие")])),_:1}),u(l).element.extension.length?(m(),h(V,{key:0,tag:"article",style:{"white-space":"break-spaces"}},{default:i(()=>[p(" ["+v(u(l).element.name)+"] ",1),e[19]||(e[19]=n("br",null,null,-1)),p(" "+v(u(l).element.extension.join(`
 `)),1)]),_:1})):y("",!0)])]))}}),Pe=J(se,[["__scopeId","data-v-7580f2c0"]]);export{Pe as default};
