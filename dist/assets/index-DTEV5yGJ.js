import{K as u,L as i,M as d,N as h,O as f}from"./index-DEZaLq76.js";import{a as p}from"./axios-CCb-kr4I.js";const l="http://192.168.20.8",n=p.create({baseURL:l});let t=0,o=null;const m=()=>{o&&(clearTimeout(o),o=null),i.pending=!0},c=()=>{o=setTimeout(()=>{i.pending=!1},1e3)},g=(e,r,s)=>{e.headers.Authorization=e.url.includes("/v1/users/revoke")?`Bearer ${s}`:`Bearer ${r}`},k=e=>(t-=1,t===0&&c(),Promise.reject(e)),v=async e=>{var s;if(t-=1,t===0&&c(),((s=e.response)==null?void 0:s.status)===401)try{const a=await R();if(e.config)return e.config.headers.Authorization=`Bearer ${a}`,n(e.config)}catch(a){return E(),Promise.reject(a)}const r=y(e);return Promise.reject(r)},E=e=>{try{d("ssoID")}catch(r){console.error("Error removing ssoID:",r)}finally{h.push({name:"user-account"})}},y=e=>{if(e.response&&"data"in e.response){const r=e.response.data;if(r&&typeof r.message=="string")return r.message}return e.message||"An unexpected error occurred"},R=async()=>{try{const e=await n.get("/v1/users/revoke"),{access_token:r,refresh_token:s}=e.data;return f("ssoID",{access_token:r,refresh_token:s}),r}catch(e){throw console.error("Error refreshing token:",e),e}};n.interceptors.request.use(e=>{t+=1,m();const{access_token:r,refresh_token:s}=u("ssoID")||{};return g(e,r,s),e},k);n.interceptors.response.use(e=>(t-=1,t===0&&c(),e),v);export{n as i};
